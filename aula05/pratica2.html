<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Document</title>
</head>
<body>
    <table border="1" id="tabelaNotas">     
        <tr bgcolor="silver"> 
            <th rowspan="2">Aluno</th>
            <th colspan="3">Semestre 1</th>
            <th colspan="3">Semestre 2</th>
            <th colspan="3">Semestre 3</th>
        </tr>

        <tr bgcolor="silver">
            <th>Nota 1</th>
            <th>Nota 2</th>
            <th>Nota 3</th>

            <th>Nota 1</th>
            <th>Nota 2</th>
            <th>Nota 3</th>

            <th>Nota 1</th>
            <th>Nota 2</th>
            <th>Nota 3</th>
        </tr>
        <tr>
            <td>João</td>
            <td>10</td>
            <td>8</td>
            <td>7</td>
            <td>6</td>
            <td>8.7</td>
            <td>10</td>
            <td>6</td>
            <td>7</td>
            <td>9</td>
        </tr>
        <tr>
            <td>Maria</td>
            <td>7</td>
            <td>9</td>
            <td>8</td>
            <td>6</td>
            <td>7.5</td>
            <td>9</td>
            <td>8</td>
            <td>8</td>
            <td>10</td>
        </tr>
        <tr>
            <td>José</td>
            <td>5</td>
            <td>6</td>
            <td>7</td>
            <td>6</td>
            <td>6.5</td>
            <td>7</td>
            <td>5</td>
            <td>7</td>
            <td>6</td>
        </tr>
        <tr>
            <td>Paulo</td>
            <td>8</td>
            <td>8</td>
            <td>9</td>
            <td>7</td>
            <td>9</td>
            <td>8</td>
            <td>9</td>
            <td>8.5</td>
            <td>9</td>
        </tr>
        <tr>
            <td>Miguel</td>
            <td>6</td>
            <td>5</td>
            <td>7</td>
            <td>6</td>
            <td>5.5</td>
            <td>7</td>
            <td>6</td>
            <td>6</td>
            <td>5</td>
        </tr>
        <tr>
            <td>Julia</td>
            <td>9</td>
            <td>8</td>
            <td>10</td>
            <td>9</td>
            <td>9.5</td>
            <td>10</td>
            <td>10</td>
            <td>9</td>
            <td>9.5</td>
        </tr>
    </table>

    <br>
    <button onclick="adicionarLinhaTotal()">Adicionar Linha de Médias</button>
    <button onclick="adicionarColunaTotal()">Adicionar Coluna de Médias</button>

    <script>

    function findFirstDataRowIndex(table) {
        const rows = table.rows;
        for (let i = 0; i < rows.length; i++) {
        if (rows[i].querySelector('td')) return i;
        }
        return -1;
    }

    function hasMediaAlunoHeader(table) {
        return Array.from(table.querySelectorAll('th')).some(th => th.textContent.trim() === 'Média Aluno');
    }

    function adicionarLinhaTotal() {
        const tabela = document.getElementById('tabelaNotas');
        const rows = tabela.rows;
        const firstData = findFirstDataRowIndex(tabela);
        if (firstData === -1) { alert('Tabela sem linhas de dados.'); return; }

        // evita adicionar duplicada
        const lastRow = rows[rows.length - 1];
        if (lastRow.cells[0] && lastRow.cells[0].textContent.trim() === 'Médias') {
        alert('A linha de médias já foi adicionada!');
        return;
        }

        const totalCols = rows[firstData].cells.length;
        const hasMediaAluno = hasMediaAlunoHeader(tabela);

        const novaLinha = tabela.insertRow();
        novaLinha.insertCell().innerHTML = '<b>Médias</b>';

        for (let c = 1; c < totalCols; c++) {

        if (hasMediaAluno && c === totalCols - 1) {
            novaLinha.insertCell().textContent = '-';
            continue;
        }

        let soma = 0, cont = 0;
        for (let r = firstData; r < rows.length; r++) {
            const row = rows[r];
            const cell = row.cells[c];
            if (!cell) continue;
            const valor = parseFloat(cell.textContent.trim().replace(',', '.'));
            if (!isNaN(valor)) { soma += valor; cont++; }
        }
        const media = cont > 0 ? (soma / cont).toFixed(2) : '-';
        novaLinha.insertCell().textContent = media;
        }
    }

    function adicionarColunaTotal() {
        const tabela = document.getElementById('tabelaNotas');
        const rows = tabela.rows;
        const firstData = findFirstDataRowIndex(tabela);
        if (firstData === -1) { alert('Tabela sem linhas de dados.'); return; }

        if (hasMediaAlunoHeader(tabela)) { alert('A coluna de médias já foi adicionada!'); return; }

        const headerRowsCount = firstData || 1;
        rows[0].insertCell().outerHTML = `<th rowspan="${headerRowsCount}">Média Aluno</th>`;

        for (let r = firstData; r < rows.length; r++) {
        const row = rows[r];
        if (row.cells[0] && row.cells[0].textContent.trim() === 'Médias') {
            row.insertCell().textContent = '-';
            continue;
        }
        let soma = 0, cont = 0;
        for (let c = 1; c < row.cells.length; c++) {
            const val = parseFloat(row.cells[c].textContent.trim().replace(',', '.'));
            if (!isNaN(val)) { soma += val; cont++; }
        }
        const media = cont > 0 ? (soma / cont).toFixed(2) : '-';
        row.insertCell().textContent = media;
        }
    }
    </script>
</body>
</html>
